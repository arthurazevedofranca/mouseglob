name: Build Windows Executable

on:
  workflow_dispatch:  # Permite rodar manualmente
  push:
    tags:
      - 'v*'  # Roda automaticamente em tags de vers√£o (v1.0.0, v2.0.1, etc)

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup JDK 21
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '21'

    - name: Setup WiX Toolset
      run: |
        choco install wixtoolset -y
        echo "C:\Program Files (x86)\WiX Toolset v3.11\bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    - name: Build with Gradle
      run: ./gradlew.bat build

    - name: Generate Windows installer
      run: ./gradlew.bat jpackage

    - name: Upload MSI installer
      uses: actions/upload-artifact@v4
      with:
        name: MouseGlob-Windows-Installer
        path: MouseGlob/build/jpackage/*.msi

    - name: Upload standalone executable
      uses: actions/upload-artifact@v4
      with:
        name: MouseGlob-Windows-Standalone
        path: MouseGlob/build/jpackage/MouseGlob/
